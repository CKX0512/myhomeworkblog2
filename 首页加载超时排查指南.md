# 首页加载超时排查指南

## 🔍 问题现象

- 页面显示"请求超时，请检查网络连接或刷新页面重试"
- 浏览器控制台显示"请求超时 (5秒), 强制结束加载"
- 网络标签页为空（没有看到任何请求）

## 🎯 可能的原因

### 1. Netlify 环境变量未配置（最常见）

**症状：** 网络标签页为空，请求根本没有发出

**解决方法：**
1. 登录 [Netlify Dashboard](https://app.netlify.com)
2. 进入你的站点 → **Site settings** → **Environment variables**
3. 确认以下两个环境变量存在且值正确：
   - `VITE_SUPABASE_URL` = 你的 Supabase 项目 URL
   - `VITE_SUPABASE_ANON_KEY` = 你的 Supabase 匿名密钥
4. 如果不存在，点击 **"Add a variable"** 添加
5. 添加后，进入 **Deploys** 标签页
6. 点击 **"Trigger deploy"** → **"Clear cache and deploy site"** 重新部署

**如何获取 Supabase 配置：**
1. 登录 [Supabase Dashboard](https://app.supabase.com)
2. 选择你的项目
3. 进入 **Settings** → **API**
4. 复制：
   - **Project URL** → `VITE_SUPABASE_URL`
   - **anon public** key → `VITE_SUPABASE_ANON_KEY`

### 2. RLS 策略阻止访问（第二常见）

**症状：** 网络标签页有请求，但返回 403 或权限错误

**解决方法：**
1. 登录 [Supabase Dashboard](https://app.supabase.com)
2. 进入你的项目
3. 点击左侧 **SQL Editor**
4. 复制 `fix_database_rls.sql` 文件中的全部内容
5. 粘贴到 SQL Editor 中
6. 点击 **Run** 执行
7. 刷新你的网站页面

### 3. Supabase 项目暂停或服务异常

**症状：** 请求发出但超时

**解决方法：**
1. 登录 [Supabase Dashboard](https://app.supabase.com)
2. 检查项目状态，确保项目是活跃的（不是暂停状态）
3. 如果项目暂停，需要恢复项目

### 4. CORS 问题

**症状：** 控制台显示 CORS 错误

**解决方法：**
1. 在 Supabase Dashboard 中，进入 **Settings** → **API**
2. 检查 **Allowed CORS origins** 设置
3. 确保你的 Netlify 域名已添加到允许列表中
4. 或者添加 `*` 允许所有来源（仅用于开发测试）

## 🛠️ 诊断步骤

### 步骤 1: 运行诊断工具

1. 打开浏览器控制台（按 `F12`）
2. 切换到 **Console** 标签页
3. 输入并回车：
   ```javascript
   diagnoseSupabase()
   ```
4. 等待诊断完成，查看输出结果

### 步骤 2: 检查控制台日志

查看控制台中的日志信息：
- ✅ 如果看到 "🔄 开始加载文章..."
- ✅ 如果看到 "📤 发送查询请求..."
- ❌ 如果看到 "❌ Supabase 客户端未初始化" → 环境变量问题
- ❌ 如果看到 "请求超时" → 网络或 RLS 问题

### 步骤 3: 检查网络请求

1. 打开浏览器控制台（按 `F12`）
2. 切换到 **Network** 标签页
3. 刷新页面（`Ctrl + R`）
4. 查看是否有请求发出：
   - 如果**完全没有请求** → 环境变量未配置
   - 如果有请求但**状态码是 403** → RLS 策略问题
   - 如果有请求但**状态码是 500** → Supabase 服务问题
   - 如果有请求但**一直 pending** → 网络超时问题

### 步骤 4: 验证环境变量

在控制台运行：
```javascript
console.log('URL:', import.meta.env.VITE_SUPABASE_URL)
console.log('Key:', import.meta.env.VITE_SUPABASE_ANON_KEY ? '已配置' : '未配置')
```

如果显示 `undefined` 或空值，说明环境变量未正确加载。

## ✅ 快速修复清单

- [ ] 检查 Netlify 环境变量是否配置
- [ ] 确认环境变量值是否正确（不是占位符）
- [ ] 重新部署 Netlify 站点（清除缓存）
- [ ] 运行 `fix_database_rls.sql` 修复 RLS 策略
- [ ] 检查 Supabase 项目是否活跃
- [ ] 运行 `diagnoseSupabase()` 查看详细诊断

## 📞 如果问题仍然存在

1. 运行 `diagnoseSupabase()` 并复制完整的输出结果
2. 检查浏览器控制台的所有错误信息
3. 检查网络标签页的请求详情
4. 将这些信息提供给技术支持

