# 注册登录功能测试指南

## 📋 测试前准备

### 1. 检查环境变量配置

确保项目根目录下有 `.env` 文件，包含以下内容：

```env
VITE_SUPABASE_URL=你的Supabase项目URL
VITE_SUPABASE_ANON_KEY=你的Supabase匿名密钥
```

**获取 Supabase 配置信息：**
1. 登录 [Supabase Dashboard](https://app.supabase.com)
2. 选择你的项目
3. 进入 **Settings** → **API**
4. 复制以下信息：
   - **Project URL** → `VITE_SUPABASE_URL`
   - **anon public** key → `VITE_SUPABASE_ANON_KEY`

### 2. 检查 Supabase 数据库设置

确保 Supabase 数据库中已创建 `users` 表，结构如下：

```sql
CREATE TABLE users (
  id UUID PRIMARY KEY REFERENCES auth.users(id),
  username TEXT NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

**检查方法：**
1. 进入 Supabase Dashboard
2. 点击左侧 **Table Editor**
3. 确认 `users` 表存在

### 3. 检查 Supabase Auth 设置

**关闭邮箱确认（用于快速测试）：**
1. 进入 Supabase Dashboard
2. 点击 **Authentication** → **Settings**
3. 找到 **Email Auth** 部分
4. 关闭 **Enable email confirmations**（测试完成后可以重新开启）

## 🚀 启动开发服务器

在项目根目录运行：

```bash
npm install  # 如果还没安装依赖
npm run dev
```

服务器启动后，访问：**http://localhost:5173**（或终端显示的地址）

## ✅ 测试步骤

### 测试 1: 注册新用户

1. **访问注册页面**
   - 点击导航栏的 **"注册"** 按钮
   - 或直接访问：`http://localhost:5173/register`

2. **填写注册信息**
   - 用户名：`testuser`
   - 邮箱：`test@example.com`（使用真实邮箱格式）
   - 密码：`123456`（至少6位）
   - 确认密码：`123456`

3. **提交注册**
   - 点击 **"注册"** 按钮
   - 应该看到成功提示："注册成功！正在跳转到登录页面..."

4. **验证结果**
   - 自动跳转到登录页面
   - 在 Supabase Dashboard → **Authentication** → **Users** 中可以看到新用户
   - 在 **Table Editor** → **users** 表中可以看到用户记录

### 测试 2: 登录

1. **访问登录页面**
   - 如果还在注册页面，会自动跳转
   - 或点击导航栏的 **"登录"** 按钮
   - 或直接访问：`http://localhost:5173/login`

2. **填写登录信息**
   - 邮箱：`test@example.com`（刚才注册的邮箱）
   - 密码：`123456`

3. **提交登录**
   - 点击 **"登录"** 按钮
   - 应该看到成功提示："登录成功！"

4. **验证登录状态**
   - 自动跳转到首页
   - 导航栏右侧显示用户名（如：`testuser`）
   - 导航栏显示 **"登出"** 按钮
   - **"写文章"** 按钮现在可见

### 测试 3: 创建文章（验证登录状态）

1. **点击"写文章"按钮**
   - 应该能正常进入创建文章页面
   - 如果未登录，会自动重定向到登录页

2. **创建一篇测试文章**
   - 标题：`我的第一篇文章`
   - 内容：`这是一篇测试文章`
   - 点击 **"发布"**

3. **验证文章作者**
   - 查看文章详情页
   - 作者应该显示为 `testuser`

### 测试 4: 登出

1. **点击导航栏的"登出"按钮**
   - 应该看到成功提示："已登出"

2. **验证登出状态**
   - 导航栏显示 **"登录"** 和 **"注册"** 按钮
   - 用户名消失
   - **"写文章"** 按钮隐藏
   - 访问 `/create` 会自动重定向到登录页

### 测试 5: 错误处理

#### 5.1 测试注册错误
- **重复邮箱**：使用已注册的邮箱再次注册，应该显示错误提示
- **密码不匹配**：确认密码与密码不一致，应该显示错误提示
- **无效邮箱格式**：输入 `invalid-email`，应该显示错误提示

#### 5.2 测试登录错误
- **错误密码**：使用错误的密码登录，应该显示错误提示
- **不存在的邮箱**：使用未注册的邮箱登录，应该显示错误提示

## 🔍 问题排查

### 问题 1: 页面显示空白

**检查：**
1. 打开浏览器控制台（F12）
2. 查看是否有错误信息
3. 检查 `.env` 文件是否正确配置
4. 确认 Supabase 项目处于活跃状态

**解决：**
- 检查环境变量是否正确
- 重启开发服务器：`Ctrl+C` 然后 `npm run dev`

### 问题 2: 注册失败

**检查：**
1. 浏览器控制台的错误信息
2. Supabase Dashboard → **Authentication** → **Logs** 查看错误日志
3. 确认 `users` 表是否存在
4. 检查 RLS（Row Level Security）策略

**解决：**
- 如果提示 "users 表不存在"，需要在 Supabase 中创建表
- 如果提示权限错误，检查 RLS 策略设置

### 问题 3: 登录后用户名不显示

**检查：**
1. 浏览器控制台是否有错误
2. Supabase Dashboard → **Table Editor** → **users** 表，确认用户记录存在
3. 检查 `fetchUserProfile` 函数是否正常工作

**解决：**
- 确认 `users` 表中有对应的用户记录
- 检查 `users` 表的 `id` 字段是否与 `auth.users.id` 匹配

### 问题 4: 无法创建文章

**检查：**
1. 确认已登录（导航栏显示用户名）
2. 检查 `posts` 表是否存在
3. 检查 `posts` 表的 RLS 策略

**解决：**
- 如果提示未登录，先登录
- 如果提示权限错误，检查 `posts` 表的 RLS 策略

## 📊 验证清单

完成测试后，确认以下功能正常：

- [ ] 可以注册新用户
- [ ] 注册后自动跳转到登录页
- [ ] 可以登录已注册的用户
- [ ] 登录后导航栏显示用户名
- [ ] 登录后可以访问"写文章"页面
- [ ] 创建的文章作者正确
- [ ] 可以正常登出
- [ ] 登出后导航栏恢复未登录状态
- [ ] 未登录时访问 `/create` 会重定向到登录页
- [ ] 错误提示正常显示（重复邮箱、错误密码等）

## 🎯 快速测试命令

如果你想快速测试多个场景，可以使用以下测试账号：

**测试账号 1：**
- 邮箱：`user1@test.com`
- 密码：`test123456`
- 用户名：`user1`

**测试账号 2：**
- 邮箱：`user2@test.com`
- 密码：`test123456`
- 用户名：`user2`

## 💡 提示

1. **开发环境**：建议关闭邮箱确认以便快速测试
2. **生产环境**：部署到生产环境时，建议开启邮箱确认
3. **密码安全**：测试时可以使用简单密码，但生产环境应要求强密码
4. **浏览器控制台**：测试时保持控制台打开，方便查看错误信息

## 🆘 需要帮助？

如果遇到问题：
1. 检查浏览器控制台的错误信息
2. 查看 Supabase Dashboard 的日志
3. 确认数据库表结构正确
4. 验证环境变量配置

---

**祝测试顺利！** 🎉

